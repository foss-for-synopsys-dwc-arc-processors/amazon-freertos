PKCS11_DIR = $(AWS_FREERTOS_ROOT)/lib/pkcs11
PKCS11_3_DIR = $(AWS_FREERTOS_ROOT)/lib/third_party/pkcs11

##
# \brief lib component related dirs
##
PKCS11_CSRCDIR =	$(PKCS11_DIR)/mbedtls \
					$(PKCS11_DIR)/portable/synopsys/embarc

PKCS11_ASMSRCDIR =	$(PKCS11_CSRCDIR)

PKCS11_INCDIR = 	$(PKCS11_3_DIR)

# find all the source files in the target directories
PKCS11_CSRCS = $(call get_csrcs, $(PKCS11_CSRCDIR))
PKCS11_ASMSRCS = $(call get_asmsrcs, $(PKCS11_ASMSRCDIR))

# get object files
PKCS11_COBJS = $(call get_aws_relobjs, $(PKCS11_CSRCS))
PKCS11_ASMOBJS = $(call get_aws_relobjs, $(PKCS11_ASMSRCS))
PKCS11_OBJS = $(PKCS11_COBJS) $(PKCS11_ASMOBJS)

# get dependency files
PKCS11_DEPS = $(call get_deps, $(PKCS11_OBJS))

# genearte library
AWS_LIB_PKCS11 = $(AWS_FREERTOS_OUT_DIR)/libpkcs11.a

# library generation rule
$(AWS_LIB_PKCS11): $(PKCS11_OBJS)
	$(TRACE_ARCHIVE)
	$(Q)$(AR) $(AR_OPT) $@ $(PKCS11_OBJS)


AWS_FREERTOS_INCDIR += $(PKCS11_INCDIR)
AWS_FREERTOS_CSRCDIR += $(PKCS11_CSRCDIR)
AWS_FREERTOS_ASMSRCDIR += $(PKCS11_ASMSRCDIR)

AWS_FREERTOS_CSRCS += $(PKCS11_CSRCS)
AWS_FREERTOS_CXXSRCS +=
AWS_FREERTOS_ASMSRCS += $(PKCS11_ASMSRCS)
AWS_FREERTOS_ALLSRCS += $(PKCS11_CSRCS) $(PKCS11_ASMSRCS)

AWS_FREERTOS_COBJS += $(PKCS11_COBJS)
AWS_FREERTOS_CXXOBJS +=
AWS_FREERTOS_ASMOBJS += $(PKCS11_ASMOBJS)
AWS_FREERTOS_ALLOBJS += $(PKCS11_OBJS)

AWS_FREERTOS_DEFINES += $(PKCS11_DEFINES)
AWS_FREERTOS_DEPS += $(PKCS11_DEPS)
AWS_FREERTOS_LIBS += $(AWS_LIB_PKCS11)
