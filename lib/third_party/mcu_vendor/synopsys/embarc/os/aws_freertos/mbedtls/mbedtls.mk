MBEDTLS_DIR = $(AWS_FREERTOS_ROOT)/lib/third_party/mbedtls

##
# \brief lib component related dirs
##
MBEDTLS_CSRCDIR = $(MBEDTLS_DIR)/library
MBEDTLS_ASMSRCDIR = $(MBEDTLS_DIR)/library
MBEDTLS_INCDIR = $(MBEDTLS_DIR)/include

# find all the source files in the target directories
MBEDTLS_CSRCS = $(call get_csrcs, $(MBEDTLS_CSRCDIR))
MBEDTLS_ASMSRCS = $(call get_asmsrcs, $(MBEDTLS_ASMSRCDIR))

# get object files
MBEDTLS_COBJS = $(call get_aws_relobjs, $(MBEDTLS_CSRCS))
MBEDTLS_ASMOBJS = $(call get_aws_relobjs, $(MBEDTLS_ASMSRCS))
MBEDTLS_OBJS = $(MBEDTLS_COBJS) $(MBEDTLS_ASMOBJS)

# get dependency files
MBEDTLS_DEPS = $(call get_deps, $(MBEDTLS_OBJS))

# genearte library
AWS_LIB_MBEDTLS = $(AWS_FREERTOS_OUT_DIR)/libmbedtls.a

# library generation rule
$(AWS_LIB_MBEDTLS): $(MBEDTLS_OBJS)
	$(TRACE_ARCHIVE)
	$(Q)$(AR) $(AR_OPT) $@ $(MBEDTLS_OBJS)


AWS_FREERTOS_INCDIR += $(MBEDTLS_INCDIR)
AWS_FREERTOS_CSRCDIR += $(MBEDTLS_CSRCDIR)
AWS_FREERTOS_ASMSRCDIR += $(MBEDTLS_ASMSRCDIR)

AWS_FREERTOS_CSRCS += $(MBEDTLS_CSRCS)
AWS_FREERTOS_CXXSRCS +=
AWS_FREERTOS_ASMSRCS += $(MBEDTLS_ASMSRCS)
AWS_FREERTOS_ALLSRCS += $(MBEDTLS_CSRCS) $(MBEDTLS_ASMSRCS)

AWS_FREERTOS_COBJS += $(MBEDTLS_COBJS)
AWS_FREERTOS_CXXOBJS +=
AWS_FREERTOS_ASMOBJS += $(MBEDTLS_ASMOBJS)
AWS_FREERTOS_ALLOBJS += $(MBEDTLS_OBJS)

AWS_FREERTOS_DEFINES += $(MBEDTLS_DEFINES)
AWS_FREERTOS_DEPS += $(MBEDTLS_DEPS)
AWS_FREERTOS_LIBS += $(AWS_LIB_MBEDTLS)
